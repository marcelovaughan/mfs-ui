{"ast":null,"code":"var _jsxFileName = \"/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/Notifications.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\n/* eslint-disable react/no-danger, react-hooks/exhaustive-deps */\nimport fetch from 'cross-fetch';\nimport React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { makeStyles } from \"../../../../packages/material-ui/src/styles\";\nimport NotificationsIcon from \"../../../../packages/material-ui-icons/src/Notifications\";\nimport Tooltip from \"../../../../packages/material-ui/src/Tooltip\";\nimport CircularProgress from \"../../../../packages/material-ui/src/CircularProgress\";\nimport IconButton from \"../../../../packages/material-ui/src/IconButton\";\nimport Badge from \"../../../../packages/material-ui/src/Badge\";\nimport Typography from \"../../../../packages/material-ui/src/Typography\";\nimport Popper from \"../../../../packages/material-ui/src/Popper\";\nimport Grow from \"../../../../packages/material-ui/src/Grow\";\nimport Paper from \"../../../../packages/material-ui/src/Paper\";\nimport ClickAwayListener from \"../../../../packages/material-ui/src/ClickAwayListener\";\nimport List from \"../../../../packages/material-ui/src/List\";\nimport ListItem from \"../../../../packages/material-ui/src/ListItem\";\nimport Divider from \"../../../../packages/material-ui/src/Divider\";\nimport sleep from \"../../../../modules/waterfall/sleep\";\nimport { getCookie } from \"../utils/helpers\";\nimport { ACTION_TYPES } from \"../constants\";\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    transformOrigin: 'top right'\n  },\n  list: {\n    width: theme.spacing(40),\n    maxHeight: theme.spacing(40),\n    overflow: 'auto'\n  },\n  listItem: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  loading: {\n    display: 'flex',\n    justifyContent: 'center',\n    margin: theme.spacing(1, 0)\n  },\n  divider: {\n    margin: theme.spacing(1, 0)\n  }\n}));\nexport default function Notifications() {\n  const classes = useStyles();\n  const [open, setOpen] = React.useState(false);\n  const [tooltipOpen, setTooltipOpen] = React.useState(false);\n  const anchorRef = React.useRef(null);\n  const t = useSelector(state => state.options.t);\n  const dispatch = useDispatch();\n  const userLanguage = useSelector(state => state.options.userLanguage);\n  const messages = useSelector(state => state.notifications.messages);\n  const lastSeen = useSelector(state => state.notifications.lastSeen);\n  const messageList = messages ? messages.filter(message => {\n    if (message.userLanguage && message.userLanguage !== userLanguage && message.userLanguage !== navigator.language.substring(0, 2)) {\n      return false;\n    }\n\n    return true;\n  }).reverse() : null;\n\n  const handleToggle = () => {\n    setOpen(prevOpen => !prevOpen);\n    setTooltipOpen(false);\n\n    if (messageList && messageList.length > 0) {\n      dispatch({\n        type: ACTION_TYPES.NOTIFICATIONS_CHANGE,\n        payload: {\n          lastSeen: messageList[0].id\n        }\n      });\n      document.cookie = `lastSeenNotification=${messageList[0].id};path=/;max-age=31536000`;\n    }\n  };\n\n  React.useEffect(() => {\n    let active = true; // Prevent search engines from indexing the notification.\n\n    if (/glebot/.test(navigator.userAgent) || messages) {\n      return undefined;\n    }\n\n    (async () => {\n      await sleep(1500); // Soften the pressure on the main thread.\n\n      let newMessages;\n\n      try {\n        const result = await fetch('https://raw.githubusercontent.com/mui-org/material-ui/master/docs/notifications.json');\n        newMessages = await result.json();\n      } catch (err) {// Swallow the exceptions, e.g. rate limit\n      }\n\n      if (active) {\n        const seen = getCookie('lastSeenNotification');\n        const lastSeenNotification = seen === '' ? 0 : parseInt(seen, 10);\n        dispatch({\n          type: ACTION_TYPES.NOTIFICATIONS_CHANGE,\n          payload: {\n            messages: newMessages || [],\n            lastSeen: lastSeenNotification\n          }\n        });\n      }\n    })();\n\n    return () => {\n      active = false;\n    };\n  }, []);\n  return __jsx(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 5\n    }\n  }, __jsx(Tooltip, {\n    open: tooltipOpen,\n    onOpen: () => {\n      setTooltipOpen(!open);\n    },\n    onClose: () => {\n      setTooltipOpen(false);\n    },\n    title: t('toggleNotifications'),\n    enterDelay: 300,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }\n  }, __jsx(IconButton, {\n    color: \"inherit\",\n    ref: anchorRef,\n    \"aria-controls\": open ? 'notifications-popup' : undefined,\n    \"aria-haspopup\": \"true\",\n    \"aria-label\": t('toggleNotifications'),\n    onClick: handleToggle,\n    \"data-ga-event-category\": \"AppBar\",\n    \"data-ga-event-action\": \"toggleNotifications\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }\n  }, __jsx(Badge, {\n    color: \"secondary\",\n    badgeContent: messageList ? messageList.reduce((count, message) => message.id > lastSeen ? count + 1 : count, 0) : 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, __jsx(NotificationsIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }\n  })))), __jsx(Popper, {\n    id: \"notifications-popup\",\n    anchorEl: anchorRef.current,\n    open: open,\n    placement: \"bottom-end\",\n    transition: true,\n    disablePortal: true,\n    role: undefined,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }, ({\n    TransitionProps\n  }) => __jsx(ClickAwayListener, {\n    onClickAway: () => {\n      setOpen(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 11\n    }\n  }, __jsx(Grow, _extends({\n    in: open\n  }, TransitionProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }\n  }), __jsx(Paper, {\n    className: classes.paper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 15\n    }\n  }, __jsx(List, {\n    className: classes.list,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 17\n    }\n  }, messageList ? messageList.map((message, index) => __jsx(React.Fragment, {\n    key: message.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 23\n    }\n  }, __jsx(ListItem, {\n    alignItems: \"flex-start\",\n    className: classes.listItem,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 25\n    }\n  }, __jsx(Typography, {\n    gutterBottom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 27\n    }\n  }, message.title), __jsx(Typography, {\n    gutterBottom: true,\n    variant: \"body2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 27\n    }\n  }, __jsx(\"span\", {\n    id: \"notification-message\",\n    dangerouslySetInnerHTML: {\n      __html: message.text\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 29\n    }\n  })), message.date && __jsx(Typography, {\n    variant: \"caption\",\n    color: \"textSecondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 29\n    }\n  }, new Date(message.date).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric'\n  }))), index < messageList.length - 1 ? __jsx(Divider, {\n    className: classes.divider,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 27\n    }\n  }) : null)) : __jsx(\"div\", {\n    className: classes.loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 21\n    }\n  }, __jsx(CircularProgress, {\n    size: 32,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 23\n    }\n  }))))))));\n}","map":{"version":3,"sources":["/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/Notifications.js"],"names":["fetch","React","useSelector","useDispatch","makeStyles","NotificationsIcon","Tooltip","CircularProgress","IconButton","Badge","Typography","Popper","Grow","Paper","ClickAwayListener","List","ListItem","Divider","sleep","getCookie","ACTION_TYPES","useStyles","theme","paper","transformOrigin","list","width","spacing","maxHeight","overflow","listItem","display","flexDirection","loading","justifyContent","margin","divider","Notifications","classes","open","setOpen","useState","tooltipOpen","setTooltipOpen","anchorRef","useRef","t","state","options","dispatch","userLanguage","messages","notifications","lastSeen","messageList","filter","message","navigator","language","substring","reverse","handleToggle","prevOpen","length","type","NOTIFICATIONS_CHANGE","payload","id","document","cookie","useEffect","active","test","userAgent","undefined","newMessages","result","json","err","seen","lastSeenNotification","parseInt","reduce","count","current","TransitionProps","map","index","title","__html","text","date","Date","toLocaleDateString","year","month","day"],"mappings":"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","sourcesContent":["/* eslint-disable react/no-danger, react-hooks/exhaustive-deps */\nimport fetch from 'cross-fetch';\nimport React from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { makeStyles } from '@material-ui/core/styles';\nimport NotificationsIcon from '@material-ui/icons/Notifications';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport IconButton from '@material-ui/core/IconButton';\nimport Badge from '@material-ui/core/Badge';\nimport Typography from '@material-ui/core/Typography';\nimport Popper from '@material-ui/core/Popper';\nimport Grow from '@material-ui/core/Grow';\nimport Paper from '@material-ui/core/Paper';\nimport ClickAwayListener from '@material-ui/core/ClickAwayListener';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport Divider from '@material-ui/core/Divider';\nimport sleep from 'modules/waterfall/sleep';\nimport { getCookie } from 'docs/src/modules/utils/helpers';\nimport { ACTION_TYPES } from 'docs/src/modules/constants';\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    transformOrigin: 'top right',\n  },\n  list: {\n    width: theme.spacing(40),\n    maxHeight: theme.spacing(40),\n    overflow: 'auto',\n  },\n  listItem: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  loading: {\n    display: 'flex',\n    justifyContent: 'center',\n    margin: theme.spacing(1, 0),\n  },\n  divider: {\n    margin: theme.spacing(1, 0),\n  },\n}));\n\nexport default function Notifications() {\n  const classes = useStyles();\n  const [open, setOpen] = React.useState(false);\n  const [tooltipOpen, setTooltipOpen] = React.useState(false);\n  const anchorRef = React.useRef(null);\n  const t = useSelector((state) => state.options.t);\n  const dispatch = useDispatch();\n  const userLanguage = useSelector((state) => state.options.userLanguage);\n  const messages = useSelector((state) => state.notifications.messages);\n  const lastSeen = useSelector((state) => state.notifications.lastSeen);\n\n  const messageList = messages\n    ? messages\n        .filter((message) => {\n          if (\n            message.userLanguage &&\n            message.userLanguage !== userLanguage &&\n            message.userLanguage !== navigator.language.substring(0, 2)\n          ) {\n            return false;\n          }\n          return true;\n        })\n        .reverse()\n    : null;\n\n  const handleToggle = () => {\n    setOpen((prevOpen) => !prevOpen);\n    setTooltipOpen(false);\n\n    if (messageList && messageList.length > 0) {\n      dispatch({\n        type: ACTION_TYPES.NOTIFICATIONS_CHANGE,\n        payload: {\n          lastSeen: messageList[0].id,\n        },\n      });\n      document.cookie = `lastSeenNotification=${messageList[0].id};path=/;max-age=31536000`;\n    }\n  };\n\n  React.useEffect(() => {\n    let active = true;\n\n    // Prevent search engines from indexing the notification.\n    if (/glebot/.test(navigator.userAgent) || messages) {\n      return undefined;\n    }\n\n    (async () => {\n      await sleep(1500); // Soften the pressure on the main thread.\n      let newMessages;\n      try {\n        const result = await fetch(\n          'https://raw.githubusercontent.com/mui-org/material-ui/master/docs/notifications.json',\n        );\n        newMessages = await result.json();\n      } catch (err) {\n        // Swallow the exceptions, e.g. rate limit\n      }\n\n      if (active) {\n        const seen = getCookie('lastSeenNotification');\n        const lastSeenNotification = seen === '' ? 0 : parseInt(seen, 10);\n\n        dispatch({\n          type: ACTION_TYPES.NOTIFICATIONS_CHANGE,\n          payload: {\n            messages: newMessages || [],\n            lastSeen: lastSeenNotification,\n          },\n        });\n      }\n    })();\n\n    return () => {\n      active = false;\n    };\n  }, []);\n\n  return (\n    <React.Fragment>\n      <Tooltip\n        open={tooltipOpen}\n        onOpen={() => {\n          setTooltipOpen(!open);\n        }}\n        onClose={() => {\n          setTooltipOpen(false);\n        }}\n        title={t('toggleNotifications')}\n        enterDelay={300}\n      >\n        <IconButton\n          color=\"inherit\"\n          ref={anchorRef}\n          aria-controls={open ? 'notifications-popup' : undefined}\n          aria-haspopup=\"true\"\n          aria-label={t('toggleNotifications')}\n          onClick={handleToggle}\n          data-ga-event-category=\"AppBar\"\n          data-ga-event-action=\"toggleNotifications\"\n        >\n          <Badge\n            color=\"secondary\"\n            badgeContent={\n              messageList\n                ? messageList.reduce(\n                    (count, message) => (message.id > lastSeen ? count + 1 : count),\n                    0,\n                  )\n                : 0\n            }\n          >\n            <NotificationsIcon />\n          </Badge>\n        </IconButton>\n      </Tooltip>\n      <Popper\n        id=\"notifications-popup\"\n        anchorEl={anchorRef.current}\n        open={open}\n        placement=\"bottom-end\"\n        transition\n        disablePortal\n        role={undefined}\n      >\n        {({ TransitionProps }) => (\n          <ClickAwayListener\n            onClickAway={() => {\n              setOpen(false);\n            }}\n          >\n            <Grow in={open} {...TransitionProps}>\n              <Paper className={classes.paper}>\n                <List className={classes.list}>\n                  {messageList ? (\n                    messageList.map((message, index) => (\n                      <React.Fragment key={message.id}>\n                        <ListItem alignItems=\"flex-start\" className={classes.listItem}>\n                          <Typography gutterBottom>{message.title}</Typography>\n                          <Typography gutterBottom variant=\"body2\">\n                            <span\n                              id=\"notification-message\"\n                              dangerouslySetInnerHTML={{ __html: message.text }}\n                            />\n                          </Typography>\n                          {message.date && (\n                            <Typography variant=\"caption\" color=\"textSecondary\">\n                              {new Date(message.date).toLocaleDateString('en-US', {\n                                year: 'numeric',\n                                month: 'long',\n                                day: 'numeric',\n                              })}\n                            </Typography>\n                          )}\n                        </ListItem>\n                        {index < messageList.length - 1 ? (\n                          <Divider className={classes.divider} />\n                        ) : null}\n                      </React.Fragment>\n                    ))\n                  ) : (\n                    <div className={classes.loading}>\n                      <CircularProgress size={32} />\n                    </div>\n                  )}\n                </List>\n              </Paper>\n            </Grow>\n          </ClickAwayListener>\n        )}\n      </Popper>\n    </React.Fragment>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}