{"ast":null,"code":"var __jsx = React.createElement;\nimport * as React from 'react';\nconst useEnhancedEffect = false && true ? React.useLayoutEffect : React.useEffect;\nexport const AdContext = React.createContext(); // Persisted for the whole session.\n// The state is used to use different ad placements.\n\nconst randomSession1 = Math.random();\nconst randomSession2 = Math.random(); // Distribution profile:\n// 25% body-image\n// 25% body-inline\n// 25% tocs-bottom-image\n// 25% tocs-top-image\n\nexport const adPlacement = randomSession1 < 0.5 ? 'body' : `tocs-${randomSession1 < 0.75 ? 'top' : 'bottom'}`;\nexport const adShape = randomSession1 < 0.5 && randomSession2 < 0.5 ? 'inline' : 'image';\nexport default function AdManager(props) {\n  const [portal, setPortal] = React.useState({});\n  useEnhancedEffect(() => {\n    if (adPlacement !== 'body' || typeof IntersectionObserver === 'undefined' || !Array.prototype.findIndex) {\n      return undefined;\n    }\n\n    const description = document.querySelector('.description');\n    setPortal({\n      placement: 'body-top',\n      element: description\n    });\n    const nodes = [description, ...Array.from(document.querySelectorAll('[data-ad=\"slot\"]'))].map(element => ({\n      element,\n      offsetTop: element.offsetTop\n    }));\n    let lastPosition;\n    const selectedNodes = nodes.filter((node, index) => {\n      if (index === 0) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      if (node.offsetTop - lastPosition > window.innerHeight * 4) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      return false;\n    });\n    const footer = nodes[nodes.length - 1];\n\n    if (selectedNodes.length > 1 && selectedNodes.indexOf(footer) === -1) {\n      selectedNodes[selectedNodes.length - 1] = footer;\n    }\n\n    const observer = new IntersectionObserver(entries => {\n      if (entries[0].isIntersecting) {\n        const element = entries[0].target;\n        const index = selectedNodes.findIndex(node => node.element === element);\n        let placement;\n\n        if (index === 0) {\n          placement = 'body-top';\n        } else if (index === selectedNodes.length - 1) {\n          placement = 'body-bottom';\n        } else {\n          placement = `body-${index}`;\n        }\n\n        setPortal({\n          placement,\n          element\n        });\n      }\n    });\n    selectedNodes.forEach((node, index) => {\n      if (index !== 0 && !node.element.style.height) {\n        node.element.style.height = '130px';\n      }\n\n      observer.observe(node.element);\n    });\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n  return __jsx(AdContext.Provider, {\n    value: {\n      portal\n    }\n  }, props.children);\n}","map":null,"metadata":{},"sourceType":"module"}