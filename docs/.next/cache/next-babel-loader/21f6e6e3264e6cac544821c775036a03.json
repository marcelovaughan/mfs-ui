{"ast":null,"code":"import _Array$from from \"@babel/runtime-corejs2/core-js/array/from\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/AdManager.js\";\nvar __jsx = React.createElement;\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nvar useEnhancedEffect = true && true ? React.useLayoutEffect : React.useEffect;\nexport var AdContext = React.createContext(); // Persisted for the whole session.\n// The state is used to use different ad placements.\n\nvar randomSession1 = Math.random();\nvar randomSession2 = Math.random(); // Distribution profile:\n// 25% body-image\n// 25% body-inline\n// 25% tocs-bottom-image\n// 25% tocs-top-image\n\nexport var adPlacement = randomSession1 < 0.5 ? 'body' : \"tocs-\".concat(randomSession1 < 0.75 ? 'top' : 'bottom');\nexport var adShape = randomSession1 < 0.5 && randomSession2 < 0.5 ? 'inline' : 'image';\nexport default function AdManager(props) {\n  var _React$useState = React.useState({}),\n      portal = _React$useState[0],\n      setPortal = _React$useState[1];\n\n  useEnhancedEffect(function () {\n    if (adPlacement !== 'body' || typeof IntersectionObserver === 'undefined' || !Array.prototype.findIndex) {\n      return undefined;\n    }\n\n    var description = document.querySelector('.description');\n    setPortal({\n      placement: 'body-top',\n      element: description\n    });\n    var nodes = [description].concat(_toConsumableArray(_Array$from(document.querySelectorAll('[data-ad=\"slot\"]')))).map(function (element) {\n      return {\n        element: element,\n        offsetTop: element.offsetTop\n      };\n    });\n    var lastPosition;\n    var selectedNodes = nodes.filter(function (node, index) {\n      if (index === 0) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      if (node.offsetTop - lastPosition > window.innerHeight * 4) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      return false;\n    });\n    var footer = nodes[nodes.length - 1];\n\n    if (selectedNodes.length > 1 && selectedNodes.indexOf(footer) === -1) {\n      selectedNodes[selectedNodes.length - 1] = footer;\n    }\n\n    var observer = new IntersectionObserver(function (entries) {\n      if (entries[0].isIntersecting) {\n        var element = entries[0].target;\n        var index = selectedNodes.findIndex(function (node) {\n          return node.element === element;\n        });\n        var placement;\n\n        if (index === 0) {\n          placement = 'body-top';\n        } else if (index === selectedNodes.length - 1) {\n          placement = 'body-bottom';\n        } else {\n          placement = \"body-\".concat(index);\n        }\n\n        setPortal({\n          placement: placement,\n          element: element\n        });\n      }\n    });\n    selectedNodes.forEach(function (node, index) {\n      if (index !== 0 && !node.element.style.height) {\n        node.element.style.height = '130px';\n      }\n\n      observer.observe(node.element);\n    });\n    return function () {\n      observer.disconnect();\n    };\n  }, []);\n  return __jsx(AdContext.Provider, {\n    value: {\n      portal: portal\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 5\n    }\n  }, props.children);\n}\nAdManager.propTypes = {\n  children: PropTypes.node\n};","map":{"version":3,"sources":["/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/AdManager.js"],"names":["useEnhancedEffect","React","AdContext","randomSession1","Math","randomSession2","adPlacement","adShape","portal","setPortal","Array","description","document","placement","element","nodes","offsetTop","selectedNodes","index","lastPosition","node","window","footer","observer","entries","props","AdManager","children","PropTypes"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport PropTypes from 'prop-types';\n\nconst useEnhancedEffect =\n  typeof window !== 'undefined' && process.env.NODE_ENV !== 'test'\n    ? React.useLayoutEffect\n    : React.useEffect;\n\nexport const AdContext = React.createContext();\n\n// Persisted for the whole session.\n// The state is used to use different ad placements.\nconst randomSession1 = Math.random();\nconst randomSession2 = Math.random();\n\n// Distribution profile:\n// 25% body-image\n// 25% body-inline\n// 25% tocs-bottom-image\n// 25% tocs-top-image\nexport const adPlacement =\n  randomSession1 < 0.5 ? 'body' : `tocs-${randomSession1 < 0.75 ? 'top' : 'bottom'}`;\n\nexport const adShape = randomSession1 < 0.5 && randomSession2 < 0.5 ? 'inline' : 'image';\n\nexport default function AdManager(props) {\n  const [portal, setPortal] = React.useState({});\n\n  useEnhancedEffect(() => {\n    if (\n      adPlacement !== 'body' ||\n      typeof IntersectionObserver === 'undefined' ||\n      !Array.prototype.findIndex\n    ) {\n      return undefined;\n    }\n\n    const description = document.querySelector('.description');\n    setPortal({ placement: 'body-top', element: description });\n\n    const nodes = [description, ...Array.from(document.querySelectorAll('[data-ad=\"slot\"]'))].map(\n      (element) => ({\n        element,\n        offsetTop: element.offsetTop,\n      }),\n    );\n\n    let lastPosition;\n\n    const selectedNodes = nodes.filter((node, index) => {\n      if (index === 0) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      if (node.offsetTop - lastPosition > window.innerHeight * 4) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n      return false;\n    });\n\n    const footer = nodes[nodes.length - 1];\n\n    if (selectedNodes.length > 1 && selectedNodes.indexOf(footer) === -1) {\n      selectedNodes[selectedNodes.length - 1] = footer;\n    }\n\n    const observer = new IntersectionObserver((entries) => {\n      if (entries[0].isIntersecting) {\n        const element = entries[0].target;\n        const index = selectedNodes.findIndex((node) => node.element === element);\n\n        let placement;\n        if (index === 0) {\n          placement = 'body-top';\n        } else if (index === selectedNodes.length - 1) {\n          placement = 'body-bottom';\n        } else {\n          placement = `body-${index}`;\n        }\n\n        setPortal({ placement, element });\n      }\n    });\n\n    selectedNodes.forEach((node, index) => {\n      if (index !== 0 && !node.element.style.height) {\n        node.element.style.height = '130px';\n      }\n      observer.observe(node.element);\n    });\n\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  return (\n    <AdContext.Provider\n      value={{\n        portal,\n      }}\n    >\n      {props.children}\n    </AdContext.Provider>\n  );\n}\n\nAdManager.propTypes = {\n  children: PropTypes.node,\n};\n"]},"metadata":{},"sourceType":"module"}