{"ast":null,"code":"import _Array$from from \"@babel/runtime-corejs2/core-js/array/from\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/AdManager.js\";\nvar __jsx = React.createElement;\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nvar useEnhancedEffect = true && true ? React.useLayoutEffect : React.useEffect;\nexport var AdContext = React.createContext(); // Persisted for the whole session.\n// The state is used to use different ad placements.\n\nvar randomSession1 = Math.random();\nvar randomSession2 = Math.random(); // Distribution profile:\n// 25% body-image\n// 25% body-inline\n// 25% tocs-bottom-image\n// 25% tocs-top-image\n\nexport var adPlacement = randomSession1 < 0.5 ? 'body' : \"tocs-\".concat(randomSession1 < 0.75 ? 'top' : 'bottom');\nexport var adShape = randomSession1 < 0.5 && randomSession2 < 0.5 ? 'inline' : 'image';\nexport default function AdManager(props) {\n  var _React$useState = React.useState({}),\n      portal = _React$useState[0],\n      setPortal = _React$useState[1];\n\n  useEnhancedEffect(function () {\n    if (adPlacement !== 'body' || typeof IntersectionObserver === 'undefined' || !Array.prototype.findIndex) {\n      return undefined;\n    }\n\n    var description = document.querySelector('.description');\n    setPortal({\n      placement: 'body-top',\n      element: description\n    });\n    var nodes = [description].concat(_toConsumableArray(_Array$from(document.querySelectorAll('[data-ad=\"slot\"]')))).map(function (element) {\n      return {\n        element: element,\n        offsetTop: element.offsetTop\n      };\n    });\n    var lastPosition;\n    var selectedNodes = nodes.filter(function (node, index) {\n      if (index === 0) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      if (node.offsetTop - lastPosition > window.innerHeight * 4) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      return false;\n    });\n    var footer = nodes[nodes.length - 1];\n\n    if (selectedNodes.length > 1 && selectedNodes.indexOf(footer) === -1) {\n      selectedNodes[selectedNodes.length - 1] = footer;\n    }\n\n    var observer = new IntersectionObserver(function (entries) {\n      if (entries[0].isIntersecting) {\n        var element = entries[0].target;\n        var index = selectedNodes.findIndex(function (node) {\n          return node.element === element;\n        });\n        var placement;\n\n        if (index === 0) {\n          placement = 'body-top';\n        } else if (index === selectedNodes.length - 1) {\n          placement = 'body-bottom';\n        } else {\n          placement = \"body-\".concat(index);\n        }\n\n        setPortal({\n          placement: placement,\n          element: element\n        });\n      }\n    });\n    selectedNodes.forEach(function (node, index) {\n      if (index !== 0 && !node.element.style.height) {\n        node.element.style.height = '130px';\n      }\n\n      observer.observe(node.element);\n    });\n    return function () {\n      observer.disconnect();\n    };\n  }, []);\n  return __jsx(AdContext.Provider, {\n    value: {\n      portal: portal\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 5\n    }\n  }, props.children);\n}\nAdManager.propTypes = {\n  children: PropTypes.node\n};","map":{"version":3,"sources":["/home/marcelo.faria/Documentos/b2w/msf-ui/docs/src/modules/components/AdManager.js"],"names":["React","PropTypes","useEnhancedEffect","useLayoutEffect","useEffect","AdContext","createContext","randomSession1","Math","random","randomSession2","adPlacement","adShape","AdManager","props","useState","portal","setPortal","IntersectionObserver","Array","prototype","findIndex","undefined","description","document","querySelector","placement","element","nodes","querySelectorAll","map","offsetTop","lastPosition","selectedNodes","filter","node","index","window","innerHeight","footer","length","indexOf","observer","entries","isIntersecting","target","forEach","style","height","observe","disconnect","children","propTypes"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport PropTypes from 'prop-types';\n\nconst useEnhancedEffect =\n  typeof window !== 'undefined' && process.env.NODE_ENV !== 'test'\n    ? React.useLayoutEffect\n    : React.useEffect;\n\nexport const AdContext = React.createContext();\n\n// Persisted for the whole session.\n// The state is used to use different ad placements.\nconst randomSession1 = Math.random();\nconst randomSession2 = Math.random();\n\n// Distribution profile:\n// 25% body-image\n// 25% body-inline\n// 25% tocs-bottom-image\n// 25% tocs-top-image\nexport const adPlacement =\n  randomSession1 < 0.5 ? 'body' : `tocs-${randomSession1 < 0.75 ? 'top' : 'bottom'}`;\n\nexport const adShape = randomSession1 < 0.5 && randomSession2 < 0.5 ? 'inline' : 'image';\n\nexport default function AdManager(props) {\n  const [portal, setPortal] = React.useState({});\n\n  useEnhancedEffect(() => {\n    if (\n      adPlacement !== 'body' ||\n      typeof IntersectionObserver === 'undefined' ||\n      !Array.prototype.findIndex\n    ) {\n      return undefined;\n    }\n\n    const description = document.querySelector('.description');\n    setPortal({ placement: 'body-top', element: description });\n\n    const nodes = [description, ...Array.from(document.querySelectorAll('[data-ad=\"slot\"]'))].map(\n      (element) => ({\n        element,\n        offsetTop: element.offsetTop,\n      }),\n    );\n\n    let lastPosition;\n\n    const selectedNodes = nodes.filter((node, index) => {\n      if (index === 0) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n\n      if (node.offsetTop - lastPosition > window.innerHeight * 4) {\n        lastPosition = node.offsetTop;\n        return true;\n      }\n      return false;\n    });\n\n    const footer = nodes[nodes.length - 1];\n\n    if (selectedNodes.length > 1 && selectedNodes.indexOf(footer) === -1) {\n      selectedNodes[selectedNodes.length - 1] = footer;\n    }\n\n    const observer = new IntersectionObserver((entries) => {\n      if (entries[0].isIntersecting) {\n        const element = entries[0].target;\n        const index = selectedNodes.findIndex((node) => node.element === element);\n\n        let placement;\n        if (index === 0) {\n          placement = 'body-top';\n        } else if (index === selectedNodes.length - 1) {\n          placement = 'body-bottom';\n        } else {\n          placement = `body-${index}`;\n        }\n\n        setPortal({ placement, element });\n      }\n    });\n\n    selectedNodes.forEach((node, index) => {\n      if (index !== 0 && !node.element.style.height) {\n        node.element.style.height = '130px';\n      }\n      observer.observe(node.element);\n    });\n\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  return (\n    <AdContext.Provider\n      value={{\n        portal,\n      }}\n    >\n      {props.children}\n    </AdContext.Provider>\n  );\n}\n\nAdManager.propTypes = {\n  children: PropTypes.node,\n};\n"]},"metadata":{},"sourceType":"module"}